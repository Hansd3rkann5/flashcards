<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0a0f1e" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Flashcards" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Engineering Flashcards | Shared Server</title>
  <link rel="icon" type="image/png" href="icons/icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"
    integrity="sha384-wcIxYkQJvRV6A7vA3HfNdc0AGJi/7luWGINuD/7++UZ5EONosFVJeFt3uTJS3BM4" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"
    integrity="sha384-hIoBPJpTUsM8c7kwh28ykVfoCENKz7LxyzKDn5XxhxL7sRKqzZo4PM5XgS5aXoaZ"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"
    integrity="sha384-hCXGrW6PitU8M1uuvvZp8K4D4ew3Efr2E1VlzDq+W8sELpAo0P5PLf4KJIp4jOSy"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
</head>

<body>
  <div id="sidebarOverlay" class="sidebar-overlay" aria-hidden="true"></div>
  <aside class="sidebar">
    <div>
      <div class="app-title">‚öôÔ∏è Engineering Flashcards</div>
    </div>
    <button id="homeBtn">üè† Home</button>
    <button id="settingsBtn">‚öôÔ∏è Settings</button>
    <div>
      <strong>Subjects</strong>
      <div id="subjectList" class="tile-grid"></div>
      <button class="btn" id="addSubjectBtn" style="margin-top:10px;width: 100%;">+ Add Subject</button>
    </div>
  </aside>

  <main class="main">
    <div id="track" class="track">
      <section class="panel" id="homePanel">
        <div id="dailyReviewHomePanel" class="section daily-review-home hidden">
          <div class="editor-header">
            <button class="btn subject-sidebar-toggle review-sidebar-toggle" id="sidebarToggleHome" type="button"
              aria-label="Open sidebar" title="Open sidebar">
              <img src="icons/burger.svg" alt="" aria-hidden="true" />
            </button>
            <h3>Review Cards</h3>
          </div>
          <div class="session-complete-message" id="dailyReviewMessage">
            Start a short review based on your latest saved card status.
          </div>
          <div class="tiny daily-review-today-stats" id="dailyReviewTodayStats"></div>
          <div class="session-complete-stats">
            <div class="session-complete-stat">
              <div class="tiny">Answered Cards</div>
              <strong id="dailyReviewTotalCards">0</strong>
            </div>
            <div class="session-repeat-controls">
              <!-- <div class="tiny">Session Size</div> -->
              <div class="counter">
                <button class="btn counter-btn" id="dailyReviewMinus" type="button">-</button>
                <div class="counter-value" id="dailyReviewSizeValue">0 / 0</div>
                <button class="btn counter-btn" id="dailyReviewPlus" type="button">+</button>
              </div>
            </div>
            <div class="session-complete-stat">
              <div class="tiny">Topics Included</div>
              <strong id="dailyReviewTotalTopics">0</strong>
            </div>
          </div>
          <div class="tiny">Status Filter (latest saved state)</div>
          <div id="dailyReviewStatusFilters" class="session-filter-list daily-review-status-list">
            <label class="session-filter-option daily-review-status-option" style="background-color: var(--success)">
              <input id="dailyReviewFilterGreen" type="checkbox" checked />
              <span>Correct</span>
            </label>
            <label class="session-filter-option daily-review-status-option" style="background-color: var(--warn)">
              <input id="dailyReviewFilterYellow" type="checkbox" />
              <span>Partialy</span>
            </label>
            <label class="session-filter-option daily-review-status-option" style="background-color: var(--danger)">
              <input id="dailyReviewFilterRed" type="checkbox" />
              <span>Wrong</span>
            </label>
          </div>
          <div class="tiny" id="dailyReviewFilterMeta" style="margin-bottom:8px;">Status: Green</div>
          <div class="daily-review-date-filter" id="dailyReviewDateFilter">
            <div class="tiny">Date Filter (latest saved date)</div>
            <div class="daily-review-date-slider-wrap" id="dailyReviewDateSliderWrap">
              <input id="dailyReviewDateStart" class="daily-review-range daily-review-range-start" type="range" min="0"
                max="0" step="1" value="0" />
              <input id="dailyReviewDateEnd" class="daily-review-range daily-review-range-end" type="range" min="0"
                max="0" step="1" value="0" />
            </div>
            <div class="tiny daily-review-date-ticks" id="dailyReviewDateTicks"></div>
          </div>
          <div class="tiny" id="dailyReviewSelectionMeta" style="margin-bottom:8px;">0 topics selected ‚Ä¢ 0 cards</div>
          <div id="dailyReviewTopicList" class="session-filter-list daily-review-topic-list"></div>
          <!-- <div class="session-repeat-controls">
            <div class="tiny">Session Size</div>
            <div class="counter">
              <button class="btn counter-btn" id="dailyReviewMinus" type="button">-</button>
              <div class="counter-value" id="dailyReviewSizeValue">0 / 0</div>
              <button class="btn counter-btn" id="dailyReviewPlus" type="button">+</button>
            </div>
          </div> -->
          <div class="controls" style="margin-top:14px; margin-inline: 0">
            <button class="btn start-daily-review-btn" id="startDailyReviewBtn" type="button">Start Review</button>
          </div>
        </div>
      </section>

      <section class="panel" id="topicPanel">
        <div class="section">
          <div class="topic-sticky-stack">
            <div class="controls topic-header" style="align-items:center;margin-inline: 0; ">
              <button class="btn subject-sidebar-toggle" id="sidebarToggle" type="button" aria-label="Open sidebar"
                title="Open sidebar">
                <img src="icons/burger.svg" alt="" aria-hidden="true" />
              </button>
              <h2 id="topicTitle" style="margin:0;">Subject</h2>
            </div>
          </div>
          <div class="study-selection section">
            <h3>Study Session</h3>
            <div class="grid two study-selection-grid">
              <div class="study-selection-card">
                <label>Session Size</label>
                <div class="counter">
                  <button class="btn counter-btn" id="sessionMinus">-</button>
                  <div class="counter-value" id="sessionSizeValue">15</div>
                  <button class="btn counter-btn" id="sessionPlus">+</button>
                </div>
                <div class="tiny">Pick how many cards to study this session.</div>
              </div>
              <div class="study-selection-card">
                <label>Selected Topics</label>
                <div id="selectedTopicsSummary" class="selected-topics-summary is-empty">Choose topics below (you can
                  mix multiple).</div>
              </div>
            </div>
            <div class="study-session-actions">
              <button class="btn" id="startSessionBtn" type="button">‚ñ∂ Start Session</button>
              <button class="btn" id="openSessionFilterBtn" type="button">Filter</button>
            </div>
            <div class="tiny session-filter-summary" id="sessionFilterSummary"></div>
          </div>
          <div class="topic-list-head">
            <h3 id="topicListTitle" class="topic-list-title">Topics</h3>
            <div class="topic-list-actions">
              <button class="btn select-cards-btn topic-search-btn" id="openTopicSearchBtn" aria-label="Search cards"
                title="Search cards" type="button">
                <img src="icons/icons8-suche-48.svg" alt="" />
              </button>
              <button class="btn select-cards-btn" id="toggleTopicSelectBtn" aria-label="Select topics"
                title="Select topics" type="button">
                <img src="icons/icons8-ha%CC%88kchen.svg" alt="" />
              </button>
            </div>
          </div>
          <div class="topic-bulk-actions hidden" id="topicBulkActions">
            <div class="tiny" id="topicSelectionCount">0 topics selected</div>
            <button class="btn" id="moveSelectedTopicsBtn" type="button">Move</button>
            <button class="btn delete" id="deleteSelectedTopicsBtn" type="button">Delete</button>
            <button class="btn" id="cancelTopicSelectionBtn" type="button">Cancel</button>
          </div>
          <div id="topicList" class="topic-list"></div>
          <hr style="border-color:#30456f">
          <h3>Add Topic</h3>
          <div class="topic-input-wrap">
            <input id="topicName" class="topic-input" placeholder="e.g., Thermodynamics" />
            <button class="btn create-card-icon-btn topic-add-btn" id="addTopicBtn" type="button" aria-label="Add topic"
              title="Add topic" style="background-color: var(--success)">+</button>
          </div>
        </div>
      </section>

      <section class="panel" id="deckPanel">
        <div class="section" id="cardsOverviewSection">
          <!-- <div class="deck-sticky-stack"> -->
          <div class="controls deck-controls deck-header-tile">
            <button class="btn" id="backToTopicsBtn">‚Üê</button>
            <div class="deck-title-wrap">
              <h2 id="deckTitle" class="deck-title">Deck</h2>
              <div id="deckTopicCardCount" class="tiny deck-topic-card-count hidden"></div>
            </div>
            <div class="deck-actions">
              <button class="btn select-cards-btn" id="toggleCardSelectBtn" aria-label="Karten ausw√§hlen"
                title="Karten ausw√§hlen" type="button">
                <img src="icons/icons8-ha%CC%88kchen.svg" alt="" />
              </button>
              <button class="btn create-card-icon-btn" id="openCreateCardBtn" style="background-color: var(--success)"
                aria-label="Create flashcard" title="Create flashcard">+</button>
            </div>
            <!-- </div> -->
            <!-- <div class="tiny deck-separator-row">
              <separator class="card-tile-separator"></separator>
            </div> -->
            <div class="deck-bulk-actions hidden" id="deckBulkActions">
              <div class="tiny" id="deckSelectionCount">0 ausgew√§hlt</div>
              <button class="btn" id="moveSelectedCardsBtn" type="button">Verschieben</button>
              <button class="btn delete" id="deleteSelectedCardsBtn" type="button">L√∂schen</button>
              <button class="btn" id="cancelCardSelectionBtn" type="button">Abbrechen</button>
            </div>
          </div>
          <div id="cardsGrid" class="card-grid"></div>
        </div>

        <div class="section hidden" id="studySessionSection" style="height: 100%;">
          <div style="margin-inline: var(--space-4)">
            <div class="session-top">
              <button class="btn" id="backToTopicsBtnSession">‚Üê</button>
              <h3>Study Session</h3>
            </div>
            <div class="session-pill-bar">
              <div id="masteredPills" class="pill-row mastered"></div>
              <div id="activePills" class="pill-row active"></div>
            </div>
          </div>
          <div class="flash-area">
            <div id="flashcard" class="flashcard hidden">
              <div class="face" id="frontFace">
                <div class="card-corner-label">
                  <span class="session-label-full">Question</span>
                  <span class="session-label-short">Q</span>
                </div>
                <div class="study-topic-pill face-topic-pill hidden" id="frontTopicPill"></div>
                <button class="btn card-edit-btn" id="editSessionCardBtn">
                  <span class="session-label-full">Edit</span>
                  <span class="session-label-short">‚Ä¶</span>
                </button>
                <div class="face-content" id="frontContent"></div>
              </div>
              <div class="face back" id="backFace">
                <div class="card-corner-label">
                  <span class="session-label-full">Answer</span>
                  <span class="session-label-short">A</span>
                </div>
                <div class="study-topic-pill face-topic-pill hidden" id="backTopicPill"></div>
                <button class="btn card-edit-btn" id="editSessionCardBtnBack">
                  <span class="session-label-full">Edit</span>
                  <span class="session-label-short">‚Ä¶</span>
                </button>
                <div class="face-content" id="backContent"></div>
              </div>
              <div class="swipe-glow" id="swipeGlow" aria-hidden="true"></div>
              <div class="swipe-badge" id="swipeBadge" aria-hidden="true"></div>
            </div>
          </div>
          <div class="controls">
            <button class="btn traffic green" data-grade="correct">Correct</button>
            <button class="btn traffic yellow" data-grade="partial">Not quite</button>
            <button class="btn traffic red" data-grade="wrong">Wrong</button>
          </div>
        </div>
      </section>

      <section class="panel" id="editorPanel">
        <div class="section editor-shell">
          <div class="controls" style="margin-bottom:10px; align-items:center; margin-inline: 0">
            <button class="btn" id="backToDeckBtn">‚Üê</button>
            <div>
              <h2 id="editorTitle" style="margin:0;">+</h2>
              <div class="tiny" id="editorSubtitle">Autosaved locally</div>
            </div>
            <button class="btn editor-sidebar-toggle" id="toggleEditorSidebarBtn">Cards</button>
          </div>
          <div id="editorOverlay" class="editor-overlay"></div>
          <div class="editor-grid">
            <div class="editor-list editor-sidebar" style="overflow: auto;">
              <div class="tiny">Existing cards</div>
              <div id="editorCardsList" class="editor-panel" style="display: block;"></div>
            </div>
            <div class="editor-separator" aria-hidden="true"></div>
            <div class="editor-panel editor-main">
              <div class="editor-main-scroll">
                <div class="editor-field">
                  <div class="field-head">
                    <label>Question</label>
                    <!-- <button class="btn btn-small formula-btn" data-formula-target="cardPrompt" type="button">Formula</button> -->
                  </div>
                  <div class="editor-input-media-row">
                    <textarea id="cardPrompt" placeholder="Type your question..."></textarea>
                    <div id="questionImagePreview" class="image-preview">Drop image here</div>
                  </div>
                  <div class="text-toolbar" data-group="create-question">
                    <div class="toolbar-segment">
                      <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                        data-group="create-question" data-align="left" aria-label="Align left"
                        title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                      <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                        data-group="create-question" data-align="center" aria-label="Align center"
                        title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                      <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                        data-group="create-question" data-align="justify" aria-label="Align justify"
                        title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
                    </div>
                    <div class="toolbar-segment">
                      <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                        data-target="cardPrompt" data-list="ul">‚Ä¢ List</button>
                      <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                        data-target="cardPrompt" data-list="ol">1. List</button>
                      <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                        data-target="cardPrompt">Table</button>
                    </div>
                  </div>
                  <div class="field-error hidden" id="questionError">Please fill in the question.</div>
                </div>
                <hr style="border-color:#30456f; width: 97%;">
                <!-- <div class="qa-editor-separator" aria-hidden="true"></div> -->
                <div class="editor-field" id="answerField">
                  <div class="mcq-primary-row" id="primaryAnswerRow">
                    <div class="mcq-primary-header hidden" id="primaryAnswerHeader">
                      <span class="mcq-badge correct" id="primaryAnswerBadge">Correct Answer ‚úì</span>
                      <label class="toggle mcq-toggle">
                        <input type="checkbox" id="primaryAnswerToggle" checked />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                    <div class="field-head">
                      <label>Answer</label>
                      <!-- <button class="btn btn-small formula-btn" data-formula-target="cardAnswer" type="button">Formula</button> -->
                    </div>
                    <div class="editor-input-media-row">
                      <textarea id="cardAnswer" placeholder="Type the answer..."></textarea>
                      <div id="answerImagePreview" class="image-preview">Drop image here</div>
                    </div>
                    <div class="text-toolbar" data-group="create-answer">
                      <div class="toolbar-segment">
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-answer" data-align="left" aria-label="Align left"
                          title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-answer" data-align="center" aria-label="Align center"
                          title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-answer" data-align="justify" aria-label="Align justify"
                          title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
                      </div>
                      <div class="toolbar-segment">
                        <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                          data-target="cardAnswer" data-list="ul">‚Ä¢ List</button>
                        <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                          data-target="cardAnswer" data-list="ol">1. List</button>
                        <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                          data-target="cardAnswer">Table</button>
                      </div>
                    </div>
                  </div>
                  <div class="editor-options">
                    <div class="tiny">Multi-select answers (optional)</div>
                    <div class="text-toolbar hidden" id="createOptionsToolbar" data-group="create-options">
                      <div class="toolbar-segment">
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-options" data-align="left" aria-label="Options align left"
                          title="Options align left"><img src="icons/links.png" alt=""></button>
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-options" data-align="center" aria-label="Options align center"
                          title="Options align center"><img src="icons/center.png" alt=""></button>
                      </div>
                    </div>
                    <div id="mcqOptions" class="hidden"></div>
                  </div>
                  <div class="field-error hidden" id="answerError">Please enter at least one answer.</div>
                </div>
              </div>
              <div class="editor-footer editor-footer-stack">
                <button class="btn" id="addMcqOptionBtn">Add Answer</button>
                <button class="btn" id="addCardBtn" style="width: 100%; background-color: #d42dba6e">Create
                  Flashcard</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // Supabase project config.
    window.__SUPABASE_URL__ = window.__SUPABASE_URL__ || 'https://ioizksaimszcsqkwqkhn.supabase.co';
    window.__SUPABASE_ANON_KEY__ = window.__SUPABASE_ANON_KEY__ || 'sb_publishable_eMvhc7DI6u_CpahCZ6dPOQ_99NFTjEk';
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js" defer></script>

  <dialog id="subjectDialog" class="modal">
    <h3>New Subject</h3>
    <div class="grid two">
      <div>
        <label>Subject Name</label>
        <input class="input" id="subjectNameInput" placeholder="e.g., Fluid Mechanics" />
      </div>
      <div>
        <label>Accent Color</label>
        <input class="input" type="color" id="subjectAccentPicker" value="#2dd4bf" />
      </div>
    </div>
    <label>Accent Hex</label>
    <input class="input" id="subjectAccentText" value="#2dd4bf" />
    <div class="tiny" style="margin:6px 0 10px;">Pick a color or paste a hex value.</div>
    <div class="palette" id="subjectPalette">
      <button type="button" data-color="#2dd4bf" style="background:#2dd4bf"></button>
      <button type="button" data-color="#22c55e" style="background:#22c55e"></button>
      <button type="button" data-color="#f59e0b" style="background:#f59e0b"></button>
      <button type="button" data-color="#ef4444" style="background:#ef4444"></button>
      <button type="button" data-color="#60a5fa" style="background:#60a5fa"></button>
      <button type="button" data-color="#a855f7" style="background:#a855f7"></button>
      <button type="button" data-color="#f472b6" style="background:#f472b6"></button>
    </div>
    <div class="controls" style="margin-top:14px;">
      <button class="btn" id="createSubjectBtn">Create Subject</button>
      <button class="btn" id="cancelSubjectBtn">Cancel</button>
    </div>
  </dialog>

  <dialog id="subjectEditDialog" class="modal">
    <h3>Edit Subject</h3>
    <div class="grid two">
      <div>
        <label>Name</label>
        <input id="editSubjectName" placeholder="e.g., Fluid Mechanics" />
      </div>
      <div>
        <label>Accent Color</label>
        <input type="color" id="editSubjectColor" value="#2dd4bf" />
      </div>
    </div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn save-primary" id="saveSubjectEditBtn">Save</button>
      <button class="btn delete" id="deleteSubjectBtn" style="width: 48%">Delete</button>
      <button class="btn" id="cancelSubjectEditBtn" style="width: 46%">Cancel</button>
    </div>
  </dialog>

  <dialog id="moveCardsDialog" class="modal">
    <h3>Karten verschieben</h3>
    <div class="tiny" id="moveCardsSelectionInfo" style="margin-bottom:10px;">0 Karten ausgew√§hlt</div>
    <div class="grid two">
      <div>
        <label>Subject</label>
        <select id="moveCardsSubjectSelect"></select>
      </div>
      <div>
        <label>Topic</label>
        <select id="moveCardsTopicSelect"></select>
      </div>
    </div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn" id="confirmMoveCardsBtn" type="button">Verschieben</button>
      <button class="btn" id="cancelMoveCardsBtn" type="button">Abbrechen</button>
    </div>
  </dialog>

  <dialog id="moveTopicsDialog" class="modal">
    <h3>Move Topics</h3>
    <div class="tiny" id="moveTopicsSelectionInfo" style="margin-bottom:10px;">0 topics selected</div>
    <div>
      <label>Target Subject</label>
      <select id="moveTopicsSubjectSelect"></select>
    </div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn" id="confirmMoveTopicsBtn" type="button">Move</button>
      <button class="btn" id="cancelMoveTopicsBtn" type="button">Cancel</button>
    </div>
  </dialog>

  <dialog id="topicSearchDialog" class="modal modal-wide" style="padding-bottom: 0;">
    <div class="topic-search-sticky-head">
      <div class="editor-header">
        <h3>Search Cards</h3>
        <button class="btn close-icon-btn" id="closeTopicSearchBtn" type="button" aria-label="Close search dialog"
          title="Close">
          <img src="icons/close.svg" alt="" aria-hidden="true" />
        </button>
      </div>
      <div class="topic-search-controls">
        <input id="topicSearchInput" type="text" placeholder="Search in question and answer text..." />
        <button class="btn" id="runTopicSearchBtn" type="button">Search</button>
      </div>
      <div class="tiny" id="topicSearchMeta">Enter a search term.</div>
    </div>
    <div id="topicSearchResults" class="card-grid topic-search-results"></div>
  </dialog>

  <dialog id="progressCheckDialog" class="modal modal-wide progress-check-dialog">
    <div class="topic-search-sticky-head progress-check-sticky-head">
      <div class="editor-header">
        <h3>Cards Status Check</h3>
        <button class="btn close-icon-btn" id="closeProgressCheckBtn" type="button"
          aria-label="Close progress check dialog" title="Close">
          <img src="icons/close.svg" alt="" aria-hidden="true" />
        </button>
      </div>
      <div class="controls" style="margin:0; margin-top:8px; justify-content: space-between; width: 100%;">
        <div class="tiny" id="progressCheckMeta">Loading...</div>
        <button class="btn" id="refreshProgressCheckBtn" type="button">Refresh</button>
      </div>
    </div>
    <div class="progress-check-table-wrap">
      <table class="progress-check-table" id="progressCheckTable">
        <thead>
          <tr>
            <th data-col="subject">
              <div class="progress-check-th-content">
                <span>Subject</span>
                <button class="progress-check-header-btn" type="button" data-col="subject"
                  aria-label="Filter subject">‚ñæ</button>
              </div>
            </th>
            <th data-col="topic">
              <div class="progress-check-th-content">
                <span>Topic</span>
                <button class="progress-check-header-btn" type="button" data-col="topic"
                  aria-label="Filter topic">‚ñæ</button>
              </div>
            </th>
            <th data-col="question">
              <div class="progress-check-th-content">
                <span>Question</span>
                <button class="progress-check-header-btn" type="button" data-col="question"
                  aria-label="Filter question">‚ñæ</button>
              </div>
            </th>
            <th data-col="current">
              <div class="progress-check-th-content">
                <span>Current</span>
                <button class="progress-check-header-btn" type="button" data-col="current"
                  aria-label="Filter current">‚ñæ</button>
              </div>
            </th>
            <th data-col="streak">
              <div class="progress-check-th-content">
                <span>Streak</span>
                <button class="progress-check-header-btn" type="button" data-col="streak"
                  aria-label="Filter streak">‚ñæ</button>
              </div>
            </th>
            <th data-col="lastGrade">
              <div class="progress-check-th-content">
                <span>Last Grade</span>
                <button class="progress-check-header-btn" type="button" data-col="lastGrade"
                  aria-label="Filter last grade">‚ñæ</button>
              </div>
            </th>
            <th data-col="lastAnsweredAt">
              <div class="progress-check-th-content">
                <span>Last Answered</span>
                <button class="progress-check-header-btn" type="button" data-col="lastAnsweredAt"
                  aria-label="Filter last answered">‚ñæ</button>
              </div>
            </th>
            <th data-col="totals">
              <div class="progress-check-th-content">
                <span>Totals (C/P/W)</span>
                <button class="progress-check-header-btn" type="button" data-col="totals"
                  aria-label="Filter totals">‚ñæ</button>
              </div>
            </th>
            <th data-col="history">
              <div class="progress-check-th-content">
                <span>History</span>
                <button class="progress-check-header-btn" type="button" data-col="history"
                  aria-label="Filter history">‚ñæ</button>
              </div>
            </th>
          </tr>
        </thead>
        <tbody id="progressCheckTableBody"></tbody>
      </table>
    </div>
    <div class="progress-check-header-menu hidden" id="progressCheckHeaderMenu">
      <div class="progress-check-header-menu-title" id="progressCheckHeaderMenuTitle">Filter</div>
      <div class="progress-check-header-menu-sort">
        <button class="btn btn-small" id="progressCheckSortAscBtn" type="button">Sort ASC</button>
        <button class="btn btn-small" id="progressCheckSortDescBtn" type="button">Sort DESC</button>
      </div>
      <label class="progress-check-select-all">
        <input id="progressCheckSelectAllValues" type="checkbox" />
        <span>Select all</span>
      </label>
      <input id="progressCheckValueSearch" type="search" placeholder="Search values..." />
      <div class="progress-check-header-menu-values" id="progressCheckHeaderMenuValues"></div>
    </div>
  </dialog>

  <dialog id="sessionFilterDialog" class="modal">
    <div class="editor-header">
      <h3>Session Filter</h3>
      <button class="btn close-icon-btn" id="closeSessionFilterBtn" type="button" aria-label="Close session filter"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="session-filter-list">
      <label class="session-filter-option">
        <input id="sessionFilterAll" type="checkbox" />
        <span>All (remaining today)</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterCorrect" type="checkbox" style="background-color: var(--success)"/>
        <span>Correctly answered (mastered)</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterPartial" type="checkbox"  style="background-color: var(--warn)"/>
        <span>Partially</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterWrong" type="checkbox"  style="background-color: var(--danger)"/>
        <span>Wrong</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterNotAnswered" type="checkbox" />
        <span>Not answered today</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterNotAnsweredYet" type="checkbox" />
        <span>Not answered yet</span>
      </label>
    </div>
    <div class="tiny" style="margin-top:10px;">All mode excludes cards mastered today (3x correct in a row).</div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn save-primary" id="saveSessionFilterBtn" type="button">Apply</button>
    </div>
  </dialog>

  <dialog id="sessionCompleteDialog" class="modal">
    <canvas id="sessionCompleteConfettiCanvas" aria-hidden="true"></canvas>
    <div class="editor-header">
      <h3>Session Complete</h3>
      <button class="btn close-icon-btn" id="closeSessionCompleteBtn" type="button"
        aria-label="Close session complete dialog" title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="session-complete-message" id="sessionCompleteMessage">Great work!</div>
    <div class="session-complete-stats">
      <div class="session-complete-stat">
        <div class="tiny">Time</div>
        <strong id="sessionCompleteDuration">0:00</strong>
      </div>
      <div class="session-complete-stat">
        <div class="tiny">Remaining Cards</div>
        <strong id="sessionCompleteRemaining">0</strong>
      </div>
    </div>
    <div class="session-repeat-controls">
      <div class="tiny">Next Session Size</div>
      <div class="counter">
        <button class="btn counter-btn" id="sessionRepeatMinus" type="button">-</button>
        <div class="counter-value" id="sessionRepeatSizeValue">0 / 0</div>
        <button class="btn counter-btn" id="sessionRepeatPlus" type="button">+</button>
      </div>
    </div>
    <div class="controls" style="margin-top:14px; margin-inline: 0">
      <button class="btn" id="startAnotherSessionBtn" type="button" style="width:100%;">Start Another Session</button>
    </div>
  </dialog>

  <dialog id="settingsDialog" class="modal">
    <div class="editor-header">
      <h3>Settings & Data</h3>
      <button class="btn close-icon-btn" id="closeSettingsBtn" type="button" aria-label="Close settings dialog"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <p class="tiny">Export and import your shared server dataset.</p>
    <div class="controls">
      <button class="btn" id="exportJsonBtn" type="button">Export JSON</button>
      <button class="btn" id="exportCsvBtn" type="button">Export CSV</button>
      <button class="btn" id="openProgressCheckFromSettingsBtn" type="button">‚úì Check Status</button>
      <label class="btn" for="importInput">Import JSON</label>
      <input id="importInput" type="file" accept="application/json" class="hidden" />
    </div>
  </dialog>

  <dialog id="editCardDialog" class="modal modal-wide">
    <div class="editor-header">
      <h3>Edit Flashcard</h3>
      <button class="btn close-icon-btn" id="closeEditCardBtn" type="button" aria-label="Close edit card dialog"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="editor-grid editor-grid-single">
      <div class="editor-panel editor-main">
        <div class="editor-main-scroll">
          <div class="editor-field">
            <div class="field-head">
              <label>Question</label>
              <!-- <button class="btn btn-small formula-btn" data-formula-target="editCardPrompt" type="button">Formula</button> -->
            </div>
            <div class="editor-input-media-row">
              <textarea id="editCardPrompt" placeholder="Type your question..."></textarea>
              <div id="editQuestionImagePreview" class="image-preview">Drop image here</div>
            </div>
            <div class="text-toolbar" data-group="edit-question">
              <div class="toolbar-segment">
                <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                  data-group="edit-question" data-align="left" aria-label="Align left"
                  title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                  data-group="edit-question" data-align="center" aria-label="Align center"
                  title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                  data-group="edit-question" data-align="justify" aria-label="Align justify"
                  title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
              </div>
              <div class="toolbar-segment">
                <button class="btn btn-small toolbar-btn" type="button" data-action="list" data-target="editCardPrompt"
                  data-list="ul">‚Ä¢ List</button>
                <button class="btn btn-small toolbar-btn" type="button" data-action="list" data-target="editCardPrompt"
                  data-list="ol">1. List</button>
                <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                  data-target="editCardPrompt">Table</button>
              </div>
            </div>
          </div>
          <!-- <div class="qa-editor-separator" aria-hidden="true"></div> -->
          <hr style="border-color:#30456f;width: 97%;">
          <div class="editor-field" id="editAnswerField">
            <div class="mcq-primary-row" id="editPrimaryAnswerRow">
              <div class="mcq-primary-header hidden" id="editPrimaryAnswerHeader">
                <span class="mcq-badge correct" id="editPrimaryAnswerBadge">Correct Answer ‚úì</span>
                <label class="toggle mcq-toggle">
                  <input type="checkbox" id="editPrimaryAnswerToggle" checked />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="field-head">
                <label>Answer</label>
                <!-- <button class="btn btn-small formula-btn" data-formula-target="editCardAnswer" type="button">Formula</button> -->
              </div>
              <div class="editor-input-media-row">
                <textarea id="editCardAnswer" placeholder="Type the answer..."></textarea>
                <div id="editAnswerImagePreview" class="image-preview">Drop image here</div>
              </div>
              <div class="text-toolbar" data-group="edit-answer">
                <div class="toolbar-segment">
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-answer" data-align="left" aria-label="Align left"
                    title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-answer" data-align="center" aria-label="Align center"
                    title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-answer" data-align="justify" aria-label="Align justify"
                    title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
                </div>
                <div class="toolbar-segment">
                  <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                    data-target="editCardAnswer" data-list="ul">‚Ä¢ List</button>
                  <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                    data-target="editCardAnswer" data-list="ol">1. List</button>
                  <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                    data-target="editCardAnswer">Table</button>
                </div>
              </div>
            </div>
            <div class="editor-options">
              <div class="tiny">Multi-select answers (optional)</div>
              <div class="text-toolbar hidden" id="editOptionsToolbar" data-group="edit-options">
                <div class="toolbar-segment">
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-options" data-align="left" aria-label="Options align left"
                    title="Options align left"><img src="icons/links.png" alt=""></button>
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-options" data-align="center" aria-label="Options align center"
                    title="Options align center"><img src="icons/center.png" alt=""></button>
                </div>
              </div>
              <div id="editMcqOptions" class="hidden"></div>
              <button class="btn" id="editAddMcqOptionBtn">Add Answer</button>
            </div>
          </div>
        </div>
        <div class="editor-footer">
          <button class="btn save-primary" id="saveEditCardBtn" style="position: sticky; bottom: 0;">Save
            Changes</button>
        </div>
      </div>
    </div>
  </dialog>

  <dialog id="cardPreviewDialog" class="modal modal-wide card-preview-dialog">
    <div class="editor-header">
      <h3>Study Preview</h3>
      <button class="btn close-icon-btn" id="closeCardPreviewBtn" type="button" aria-label="Close study preview"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="tiny">Tap the card to flip. Space also flips.</div>
    <div class="card-preview-shell">
      <div class="flash-area card-preview-area">
        <div id="previewFlashcard" class="flashcard">
          <div class="face">
            <div class="card-corner-label">Question</div>
            <div class="study-topic-pill face-topic-pill hidden" id="previewFrontTopicPill"></div>
            <div class="face-content" id="previewFrontContent"></div>
          </div>
          <div class="face back">
            <div class="card-corner-label">Answer</div>
            <div class="study-topic-pill face-topic-pill hidden" id="previewBackTopicPill"></div>
            <div class="face-content" id="previewBackContent"></div>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <dialog id="tableDialog" class="modal modal-table-builder">
    <div class="editor-header">
      <h3>Table Generator</h3>
      <button class="btn close-icon-btn" id="closeTableBtn" type="button" aria-label="Close table dialog" title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="tiny" id="tableTargetLabel">Target: Question</div>
    <div class="table-builder-controls">
      <div class="table-builder-size">
        <label for="tableRowsInput">Rows</label>
        <div class="table-builder-stepper">
          <button class="btn btn-small" id="tableRowsDownBtn" type="button" aria-label="Decrease rows">-</button>
          <input id="tableRowsInput" type="number" min="1" max="20" step="1" value="3" />
          <button class="btn btn-small" id="tableRowsUpBtn" type="button" aria-label="Increase rows">+</button>
        </div>
      </div>
      <div class="table-builder-size">
        <label for="tableColsInput">Columns</label>
        <div class="table-builder-stepper">
          <button class="btn btn-small" id="tableColsDownBtn" type="button" aria-label="Decrease columns">-</button>
          <input id="tableColsInput" type="number" min="1" max="10" step="1" value="3" />
          <button class="btn btn-small" id="tableColsUpBtn" type="button" aria-label="Increase columns">+</button>
        </div>
      </div>
      <div class="table-builder-header-toggle">
        <span>Header</span>
        <label class="toggle">
          <input id="tableHeaderToggle" type="checkbox" checked />
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="table-builder-align" role="group" aria-label="Selected cell alignment">
        <div class="tiny" id="tableCellSelectionLabel">Cell: none selected</div>
        <div class="table-builder-align-buttons">
          <button class="btn btn-small toolbar-btn table-builder-align-btn align-icon-btn" id="tableAlignLeftBtn"
            type="button" data-align="left" aria-label="Align selected cell left"><img src="icons/links.png"
              alt=""></button>
          <button class="btn btn-small toolbar-btn table-builder-align-btn align-icon-btn" id="tableAlignCenterBtn"
            type="button" data-align="center" aria-label="Align selected cell center"><img src="icons/center.png"
              alt=""></button>
          <button class="btn btn-small toolbar-btn table-builder-align-btn align-icon-btn" id="tableAlignRightBtn"
            type="button" data-align="right" aria-label="Align selected cell right"><img src="icons/rechts.png"
              alt=""></button>
        </div>
      </div>
      <div class="table-builder-merge" role="group" aria-label="Merge selected cells">
        <button class="btn btn-small" id="tableMergeBtn" type="button">Merge</button>
        <button class="btn btn-small" id="tableUnmergeBtn" type="button">Unmerge</button>
      </div>
    </div>
    <div class="tiny table-builder-help">Edit cells directly. Click start cell, then Shift+Click end cell to select a
      full range, then Merge/Unmerge.
      Use Shift + Enter to insert/update.</div>
    <div id="tableBuilderGrid" class="table-builder-grid" role="region" aria-label="Editable table grid"></div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn" id="insertTableBtn" type="button" style="width: 100%; background-color: #6f2bd4">Insert Table</button>
    </div>
  </dialog>

  <dialog id="formulaDialog" class="modal modal-wide">
    <div class="editor-header">
      <h3>Formula Editor</h3>
      <button class="btn close-icon-btn" id="closeFormulaBtn" type="button" aria-label="Close formula dialog"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="editor-grid editor-grid-single">
      <div class="editor-panel editor-main">
        <div class="editor-field">
          <div class="field-head">
            <label>LaTeX Formula</label>
            <div class="toggle-row">
              <label class="toggle">
                <input type="checkbox" id="formulaDisplayToggle" />
                <span class="toggle-slider"></span>
              </label>
              <span class="tiny">Display mode</span>
            </div>
          </div>
          <textarea id="formulaInput" placeholder="e.g. \\frac{a}{b}"></textarea>
          <div class="formula-preview">
            <div id="formulaRender" class="formula-render"></div>
          </div>
          <div class="field-error hidden" id="formulaError"></div>
        </div>
        <div class="controls" style="justify-content: space-between;">
          <div class="tiny" id="formulaTargetLabel">Target: Question</div>
          <div class="formula-actions">
            <button class="btn" id="cancelFormulaBtn" type="button">Cancel</button>
            <button class="btn save-primary formula-insert" id="insertFormulaBtn" type="button">Insert Formula</button>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <div id="sessionImageLightbox" class="session-image-lightbox hidden" aria-hidden="true">
    <img id="sessionImageLightboxImg" src="" alt="Expanded flashcard image" />
  </div>

</body>

</html>
