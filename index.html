<!DOCTYPE html>
<html lang="en-GB">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0a0f1e" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Flashcards" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Engineering Flashcards | Shared Server</title>
  <link rel="icon" type="image/png" href="icons/icon.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"
    integrity="sha384-CIGaNQlQjmh0mdnW7ufcsOGCO5lCw/pwP5dxgDyVJjwFzJmlsJ4ojIKGJT/PpBb5" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"
    integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"
    integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
</head>

<body>
  <div id="authGate" class="auth-gate hidden" aria-hidden="true">
    <div class="auth-card" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <h2 id="authTitle">Sign In</h2>
      <p class="tiny">Please sign in with your Supabase account to open the app.</p>
      <form id="authForm" class="auth-form" autocomplete="on">
        <label for="authEmail">Email</label>
        <input id="authEmail" class="input" type="email" autocomplete="email" required placeholder="name@example.com" />
        <label for="authPassword">Password</label>
        <input id="authPassword" class="input" type="password" autocomplete="current-password" required
          placeholder="Your password" />
        <div class="auth-actions">
          <button class="btn" id="authSignInBtn" type="submit" style="background: var(--button);">Sign In</button>
          <button class="btn" id="authSignUpBtn" type="button">Create Account</button>
        </div>
      </form>
      <div class="tiny auth-message" id="authMessage" aria-live="polite"></div>
    </div>
  </div>

  <div id="onboardingTutorial" class="onboarding-tutorial hidden" aria-hidden="true">
    <div class="onboarding-card" role="dialog" aria-modal="true" aria-labelledby="onboardingTutorialTitle"
      aria-describedby="onboardingTutorialBody">
      <div id="onboardingTutorialMain" class="onboarding-main">
        <div class="tiny onboarding-step-meta" id="onboardingTutorialStepMeta">Step 1 of 6</div>
        <h2 id="onboardingTutorialTitle">Welcome to Engineering Flashcards</h2>
        <p id="onboardingTutorialBody">
          Build your first study flow by creating a subject, then adding topics and cards.
        </p>
        <div id="onboardingNameBlock" class="onboarding-name-block hidden">
          <label for="onboardingNameInput">Your name</label>
          <input id="onboardingNameInput" class="input" type="text" maxlength="80" autocomplete="name"
            placeholder="Enter your name" />
          <div id="onboardingNameMessage" class="tiny onboarding-name-message" aria-live="polite"></div>
        </div>
        <div class="tiny onboarding-shortcuts">Use Left and Right Arrow keys to continue.</div>
      </div>
      <div class="onboarding-controls">
        <button class="btn onboarding-nav-btn" id="onboardingTutorialPrevBtn" type="button"
          aria-label="Previous step">
          <img src="icons/back.png" alt="" class="back-btn-icon" aria-hidden="true" />
        </button>
        <div id="onboardingTutorialDots" class="onboarding-dots" aria-label="Tutorial progress"></div>
        <button class="btn onboarding-nav-btn" id="onboardingTutorialNextBtn" type="button"
          aria-label="Next step">‚Üí</button>
      </div>
    </div>
  </div>

  <div id="editorIntro" class="editor-intro hidden" aria-hidden="true">
    <div class="editor-intro-card" role="dialog" aria-modal="true" aria-labelledby="editorIntroTitle"
      aria-describedby="editorIntroBody">
      <div id="editorIntroMain" class="editor-intro-main">
        <h2 id="editorIntroTitle">Editor Quick Intro</h2>
        <p id="editorIntroBody">
          This panel is optimized for quick card creation. Here are the available keyboard shortcuts and key-driven
          behaviors.
        </p>
        <div id="editorIntroShortcutList" class="editor-intro-shortcuts"></div>
        <div class="tiny editor-intro-footnote">Use the shortcuts directly in Question, Answer, and MCQ option fields.
        </div>
      </div>
      <div class="controls" style="margin-top:12px; margin-inline:0;">
        <button class="btn save-primary" id="editorIntroCloseBtn" type="button">Start Editing</button>
      </div>
    </div>
  </div>

  <div id="sidebarOverlay" class="sidebar-overlay" aria-hidden="true"></div>
  <div id="appLoadingOverlay" class="app-loading-overlay" aria-hidden="true">
    <div class="app-loading-inner" role="status" aria-live="polite" aria-atomic="true">
      <div class="app-loader-stack" aria-hidden="true">
        <span class="app-loader-card card-one"></span>
        <span class="app-loader-card card-two"></span>
        <span class="app-loader-card card-three"></span>
      </div>
      <div class="tiny app-loading-label" id="appLoadingLabel">Preparing session...</div>
    </div>
  </div>
  <aside class="sidebar">
    <div>
      <div class="app-title">‚öôÔ∏è Engineering Flashcards</div>
    </div>
    <button id="homeBtn">üè† Home</button>
    <button id="settingsBtn">‚öôÔ∏è Settings</button>
    <button id="archiveBtn">üìÅ Archive</button>
<!--     
    <button id="archiveBtn" class="sidebar-archive-btn" type="button" aria-label="Open archived subjects">
      <img src="icons/archive.png" alt="" class="sidebar-action-icon" aria-hidden="true" />
      <span>Archive</span>
    </button> -->
    <div class="sidebar-subjects">
      <div class="sidebar-subjects-header">
        <strong>Subjects</strong>
        <button class="btn select-cards-btn" id="addSubjectBtn" style="background-color: var(--success)">
          <img src="icons/plus.svg" alt="" />
        </button>
      </div>
      <div id="subjectList" class="tile-grid"></div>
      <!-- <button class="btn" id="addSubjectBtn" style="margin-top:10px;width: 100%;">+ Add Subject</button> -->
    </div>
    <div class="sidebar-meta" id="sidebarMeta">
      <div class="tiny sidebar-meta-line">¬© SimonBader, <span id="appVersionLabel"></span></div>
    </div>
  </aside>

  <main class="main">
    <div id="track" class="track">
      <section class="panel" id="homePanel">
        <div id="homePullToRefresh" class="home-pull-refresh" aria-hidden="true">
          <div class="home-pull-refresh-track">
            <div id="homePullToRefreshFill" class="home-pull-refresh-fill"></div>
          </div>
          <div class="tiny home-pull-refresh-label" id="homePullToRefreshLabel">Pull to refresh</div>
        </div>
        <div id="dailyReviewHomePanel" class="section daily-review-home hidden">
          <div class="review-header-tile">
            <button class="btn subject-sidebar-toggle review-sidebar-toggle" id="sidebarToggleHome" type="button"
              aria-label="Open sidebar" title="Open sidebar">
              <img src="icons/burger.svg" alt="" aria-hidden="true" />
            </button>
            <h3 class="review-header-title">Review Cards</h3>
          </div>
          <div class="session-complete-message" id="dailyReviewMessage">
            Start a short review based on your latest saved card status.
          </div>
          <div class="tiny daily-review-today-stats" id="dailyReviewTodayStats"></div>
          <div class="daily-overview-stats-grid" id="dailyOverviewStatsGrid">
            <article class="daily-overview-stat-card">
              <div class="tiny daily-overview-stat-title">Learning State</div>
              <div class="daily-overview-segment-bar" id="dailyOverviewStateBar" role="img"
                aria-label="Mastered, partially answered, and wrong ratio"></div>
              <div class="tiny daily-overview-segment-legend" id="dailyOverviewStateLegend"></div>
            </article>
            <article class="daily-overview-stat-card daily-overview-streak-card">
              <div>
                <div class="tiny daily-overview-stat-title" id="currentStreak"></div>
                <div class="tiny daily-overview-streak-meta" id="dailyOverviewStreakMeta"></div>
              </div>
              <div class="daily-overview-streak-value">
                <strong id="dailyOverviewStreakDays">0</strong>
                <div style="margin-top: auto;">
                  <h2 id="dayText" style="margin-top: 0;margin-bottom: 8px;"></h2>
                </div>
              </div>
            </article>
          </div>
          <!-- <div class="daily-review-analytics-header">
            <div class="tiny">Analytics</div>
            <button class="btn daily-review-analytics-toggle" id="toggleDailyReviewAnalyticsBtn" type="button"
              aria-expanded="true">Hide charts</button>
          </div> -->
          <!-- <div id="dailyReviewAnalytics" class="daily-review-analytics"></div> -->
          <div class="session-complete-stats">
            <div class="session-complete-stat">
              <div class="tiny">Answered Cards</div>
              <strong id="dailyReviewTotalCards">0</strong>
            </div>
            <div class="session-repeat-controls">
              <!-- <div class="tiny">Session Size</div> -->
              <div class="counter">
                <button class="btn counter-btn" id="dailyReviewMinus" type="button">-</button>
                <div class="counter-value" id="dailyReviewSizeValue">0 / 0</div>
                <button class="btn counter-btn" id="dailyReviewPlus" type="button">+</button>
              </div>
            </div>
            <div class="session-complete-stat">
              <div class="tiny">Topics Included</div>
              <strong id="dailyReviewTotalTopics">0</strong>
            </div>
          </div>
          <div class="tiny">Status Filter (latest saved state)</div>
          <div id="dailyReviewStatusFilters" class="session-filter-list daily-review-status-list">
            <label class="session-filter-option daily-review-status-option" style="background-color: var(--success)">
              <input id="dailyReviewFilterGreen" type="checkbox" checked />
              <span>Correct</span>
            </label>
            <label class="session-filter-option daily-review-status-option" style="background-color: var(--warn)">
              <input id="dailyReviewFilterYellow" type="checkbox" />
              <span>Partialy</span>
            </label>
            <label class="session-filter-option daily-review-status-option" style="background-color: var(--danger)">
              <input id="dailyReviewFilterRed" type="checkbox" />
              <span>Wrong</span>
            </label>
          </div>
          <div class="tiny" id="dailyReviewFilterMeta" style="margin-bottom:8px;">Status: Green</div>
          <div class="daily-review-date-filter" id="dailyReviewDateFilter">
            <div class="tiny">Date Filter (latest saved date)</div>
            <div class="daily-review-date-slider-wrap" id="dailyReviewDateSliderWrap">
              <input id="dailyReviewDateStart" class="daily-review-range daily-review-range-start" type="range" min="0"
                max="0" step="1" value="0" />
              <input id="dailyReviewDateEnd" class="daily-review-range daily-review-range-end" type="range" min="0"
                max="0" step="1" value="0" />
            </div>
            <div class="tiny daily-review-date-ticks" id="dailyReviewDateTicks"></div>
          </div>
          <div class="tiny" id="dailyReviewSelectionMeta" style="margin-bottom:8px;">0 topics selected ‚Ä¢ 0 cards</div>
          <div id="dailyReviewTopicList" class="session-filter-list daily-review-topic-list"></div>
          <!-- <div class="session-repeat-controls">
            <div class="tiny">Session Size</div>
            <div class="counter">
              <button class="btn counter-btn" id="dailyReviewMinus" type="button">-</button>
              <div class="counter-value" id="dailyReviewSizeValue">0 / 0</div>
              <button class="btn counter-btn" id="dailyReviewPlus" type="button">+</button>
            </div>
          </div> -->
          <div class="controls" style="margin-top:14px; margin-inline: 0">
            <button class="btn start-daily-review-btn" id="startDailyReviewBtn" type="button">Start Review</button>
            <!-- <button class="btn debug-loader-btn" id="debugLoaderBtn" type="button">Debug Loader</button> -->
          </div>
        </div>
      </section>

      <section class="panel" id="topicPanel">
        <div class="section">
          <div class="topic-sticky-stack">
            <div class="controls topic-header" style="align-items:center;margin-inline: 0; ">
              <button class="btn subject-sidebar-toggle" id="sidebarToggle" type="button" aria-label="Open sidebar"
                title="Open sidebar">
                <img src="icons/burger.svg" alt="" aria-hidden="true" />
              </button>
              <h2 id="topicTitle" style="margin:0;">Subject</h2>
            </div>
          </div>
          <div class="subject-progress-panel hidden" id="subjectProgressPanel">
            <div class="subject-progress-header">
              <h3 class="subject-progress-title">Subject Progress</h3>
              <span class="tiny subject-progress-meta" id="subjectProgressMeta">0 cards</span>
            </div>
            <div class="subject-progress-bar-wrap">
              <div class="daily-overview-segment-bar subject-progress-segment-bar" id="subjectProgressBar" role="img"
                aria-label="Subject ratio for mastered, partially answered, wrong, and not answered yet"></div>
            </div>
            <div class="tiny daily-overview-segment-legend" id="subjectProgressLegend"></div>
          </div>
          <div class="study-selection section">
            <h3>Study Session</h3>
            <div class="grid two study-selection-grid">
              <div class="study-selection-card">
                <label>Session Size</label>
                <div class="counter">
                  <button class="btn counter-btn" id="sessionMinus">-</button>
                  <div class="counter-value" id="sessionSizeValue">
                    <span class="session-size-value-text">15</span>
                    <div class="session-size-loader" aria-hidden="true">
                      <div class="app-loader-stack">
                        <span class="app-loader-card card-one"></span>
                        <span class="app-loader-card card-two"></span>
                        <span class="app-loader-card card-three"></span>
                      </div>
                    </div>
                  </div>
                  <button class="btn counter-btn" id="sessionPlus">+</button>
                </div>
                <div class="tiny">Pick how many cards to study this session.</div>
              </div>
              <div class="study-selection-card">
                <label>Selected Topics</label>
                <div id="selectedTopicsSummary" class="selected-topics-summary is-empty">Choose topics below (you can
                  mix multiple).</div>
              </div>
            </div>
            <div class="study-session-actions">
              <button class="btn" id="startSessionBtn" type="button">‚ñ∂ Start Session</button>
              <button class="btn" id="openSessionFilterBtn" type="button">Filter</button>
            </div>
            <div class="tiny session-filter-summary" id="sessionFilterSummary"></div>
          </div>
          <div class="topic-list-head">
            <div class="topic-list-title-wrap">
              <h3 id="topicListTitle" class="topic-list-title">Topics</h3>
              <span id="topicListTotalCards" class="tiny topic-list-total-cards">0 cards</span>
            </div>
            <div class="topic-list-actions">
              <button class="btn select-cards-btn topic-search-btn scale" id="openTopicSearchBtn" aria-label="Search cards"
                title="Search cards" type="button">
                <img src="icons/icons8-suche-48.svg" alt="" />
              </button>
              <button class="btn select-cards-btn" id="selectAllSessionTopicsBtn" type="button">All</button>
              <button class="btn select-cards-btn" id="toggleTopicSelectBtn" aria-label="Select topics"
                title="Select topics" type="button">
                <img src="icons/check.svg" alt="" />
              </button>
            </div>
          </div>
          <div class="topic-bulk-actions hidden" id="topicBulkActions">
            <div class="tiny" id="topicSelectionCount">0 topics selected</div>
            <button class="btn topic-all-btn" id="selectAllBulkTopicsBtn" type="button">All</button>
            <button class="btn" id="moveSelectedTopicsBtn" type="button">Move</button>
            <button class="btn delete" id="deleteSelectedTopicsBtn" type="button">Delete</button>
            <button class="btn" id="cancelTopicSelectionBtn" type="button">Cancel</button>
          </div>
          <div id="topicList" class="topic-list"></div>
          <hr style="border-color:#30456f">
          <h3>Add Topic</h3>
          <div class="topic-input-wrap">
            <input id="topicName" class="topic-input" placeholder="e.g., Thermodynamics" />
            <button class="btn create-card-icon-btn topic-add-btn" id="addTopicBtn" type="button" aria-label="Add topic"
              title="Add topic" style="background-color: var(--success)">+</button>
          </div>
        </div>
      </section>

      <section class="panel" id="deckPanel">
        <div class="section" id="cardsOverviewSection">
          <!-- <div class="deck-sticky-stack"> -->
          <div class="controls deck-controls deck-header-tile">
            <button class="btn" id="backToTopicsBtn" aria-label="Back to topics">
              <img src="icons/back.png" alt="" class="back-btn-icon" aria-hidden="true" />
            </button>
            <div class="deck-title-wrap">
              <h2 id="deckTitle" class="deck-title">Deck</h2>
              <div id="deckTopicCardCount" class="tiny deck-topic-card-count hidden"></div>
            </div>
            <div class="deck-actions">
              <button class="btn select-cards-btn" id="toggleCardSelectBtn" aria-label="Select cards"
                title="Select cards" type="button">
                <img src="icons/check.svg" alt="" />
              </button>
              <button class="btn select-cards-btn topic-more-btn" id="openTopicEditBtn" aria-label="Rename topic"
                title="Rename topic" type="button">
                <img src="icons/edit.png" alt="" class="edit-btn-icon" aria-hidden="true" />
              </button>
              <button class="btn select-cards-btn create-card-icon-btn" id="openCreateCardBtn" style="background-color: var(--success)"
                aria-label="Create flashcard" title="Create flashcard">
                <img src="icons/plus.svg" alt="" />
              </button>
            </div>
            <!-- </div> -->
            <!-- <div class="tiny deck-separator-row">
              <separator class="card-tile-separator"></separator>
            </div> -->
            <div class="deck-bulk-actions hidden" id="deckBulkActions">
              <div class="tiny" id="deckSelectionCount">0 selected</div>
              <button class="btn" id="moveSelectedCardsBtn" type="button">Move</button>
              <button class="btn delete" id="deleteSelectedCardsBtn" type="button">Delete</button>
              <button class="btn" id="cancelCardSelectionBtn" type="button">Cancel</button>
            </div>
          </div>
          <div id="cardsGrid" class="card-grid"></div>
        </div>

        <div class="section hidden" id="studySessionSection" style="height: 100%;">
          <div class="session-top">
            <button class="btn" id="backToTopicsBtnSession" style="position: absolute;" aria-label="Back to topics">
              <img src="icons/back.png" alt="" class="back-btn-icon" aria-hidden="true" />
            </button>
            <div id="sessionPillBar" class="session-pill-bar">
              <div id="masteredPills" class="pill-row mastered"></div>
              <div id="activePills" class="pill-row active"></div>
            </div>
            <!-- <div class="session-pill-bar">
              <div id="masteredPills" class="pill-row mastered"></div>
              <div id="activePills" class="pill-row active"></div>
            </div> -->
          </div>
          <!-- <button class="btn session-scale-debug-btn" id="sessionScaleDebugBtn" type="button"
            title="Open scale tuning controls">Scale Debug</button> -->
          <div id="sessionScaleDebugPanel" class="session-scale-debug-panel hidden">
            <div class="session-scale-debug-head">
              <strong>Next Card Scale Tuning</strong>
              <div class="session-scale-debug-actions">
                <button class="btn btn-small" id="sessionScaleDebugPrintBtn" type="button">Print</button>
                <button class="btn btn-small" id="sessionScaleDebugResetBtn" type="button">Reset</button>
              </div>
            </div>
            <div class="session-scale-debug-grid">
              <label class="session-scale-debug-field">Start H Fraction
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Horizontal: next-card scaling starts at this fraction of the commit distance. Range 0.00 to 0.95.">i</span>
                <input id="sessionScaleDebugRevealStartH" type="number" step="0.01" min="0" max="0.95" />
              </label>
              <label class="session-scale-debug-field">End H Fraction
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Horizontal: progress reaches 1 at this fraction. Higher values make scaling grow more slowly. Range 0.05 to 2.00.">i</span>
                <input id="sessionScaleDebugRevealEndH" type="number" step="0.01" min="0.05" max="2" />
              </label>
              <label class="session-scale-debug-field">Start V Fraction
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Vertical (downward): start point of scaling relative to commit distance. Range 0.00 to 0.95.">i</span>
                <input id="sessionScaleDebugRevealStartV" type="number" step="0.01" min="0" max="0.95" />
              </label>
              <label class="session-scale-debug-field">End V Fraction
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Vertical (downward): point where progress reaches 1. Range 0.05 to 2.00.">i</span>
                <input id="sessionScaleDebugRevealEndV" type="number" step="0.01" min="0.05" max="2" />
              </label>
              <label class="session-scale-debug-field">Side Swipe Ratio
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Left/right direction detection: lower values are more tolerant for diagonal gestures. Range 0.40 to 1.40.">i</span>
                <input id="sessionScaleDebugSideRatio" type="number" step="0.01" min="0.4" max="1.4" />
              </label>
              <label class="session-scale-debug-field">Commit X Fraction
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Horizontal commit threshold as a fraction of card width. Range 0.05 to 0.45.">i</span>
                <input id="sessionScaleDebugCommitXFraction" type="number" step="0.01" min="0.05" max="0.45" />
              </label>
              <label class="session-scale-debug-field">Commit X Min (px)
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Minimum horizontal commit distance in pixels. Applies in addition to the fraction. Range 8 to 200.">i</span>
                <input id="sessionScaleDebugCommitXMin" type="number" step="1" min="8" max="200" />
              </label>
              <label class="session-scale-debug-field">Commit Y Fraction
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Vertical commit threshold as a fraction of card height. Range 0.10 to 0.60.">i</span>
                <input id="sessionScaleDebugCommitYFraction" type="number" step="0.01" min="0.1" max="0.6" />
              </label>
              <label class="session-scale-debug-field">Commit Y Min (px)
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Minimum vertical commit distance in pixels. Applies in addition to the fraction. Range 20 to 320.">i</span>
                <input id="sessionScaleDebugCommitYMin" type="number" step="1" min="20" max="320" />
              </label>
              <label class="session-scale-debug-field">Scale Min
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Minimum scale value of the next card (progress=0). Range 0.00 to 2.00.">i</span>
                <input id="sessionScaleDebugScaleMin" type="number" step="0.01" min="0" max="2" />
              </label>
              <label class="session-scale-debug-field">Scale Max
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Maximum scale value (progress=1). Range 0.00 to 2.50.">i</span>
                <input id="sessionScaleDebugScaleMax" type="number" step="0.01" min="0" max="2.5" />
              </label>
              <label class="session-scale-debug-field">Depth Start (px)
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Initial Z depth of the next card. Negative values place it farther back. Range -1600 to 600.">i</span>
                <input id="sessionScaleDebugDepthStart" type="number" step="10" min="-1600" max="600" />
              </label>
              <label class="session-scale-debug-field">Depth End (px)
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Final Z depth at progress=1. Range -1600 to 800.">i</span>
                <input id="sessionScaleDebugDepthEnd" type="number" step="10" min="-1600" max="800" />
              </label>
              <label class="session-scale-debug-field">Tilt Start (deg)
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Initial tilt of the next card at progress=0. Range -35 to 35 degrees.">i</span>
                <input id="sessionScaleDebugTiltStart" type="number" step="0.1" min="-35" max="35" />
              </label>
              <label class="session-scale-debug-field">Tilt End (deg)
                <span class="session-scale-debug-info" tabindex="0"
                  data-tip="Final tilt at progress=1. Range -35 to 35 degrees.">i</span>
                <input id="sessionScaleDebugTiltEnd" type="number" step="0.1" min="-35" max="35" />
              </label>
            </div>
          </div>
          <div class="flash-area">
            <div id="flashcard" class="flashcard hidden">
              <div class="face" id="frontFace">
                <div class="card-corner-label">
                  <span class="session-label-full">Question</span>
                  <span class="session-label-short">Q</span>
                </div>
                <div class="study-topic-pill face-topic-pill hidden" id="frontTopicPill"></div>
                <button class="btn card-edit-btn" id="editSessionCardBtn" type="button" aria-label="Edit card"
                  title="Edit card">
                  <img src="icons/edit.png" alt="" class="edit-btn-icon" aria-hidden="true" />
                </button>
                <div class="face-content" id="frontContent"></div>
              </div>
              <div class="face back" id="backFace">
                <div class="card-corner-label">
                  <span class="session-label-full">Answer</span>
                  <span class="session-label-short">A</span>
                </div>
                <div class="study-topic-pill face-topic-pill hidden" id="backTopicPill"></div>
                <button class="btn card-edit-btn" id="editSessionCardBtnBack" type="button" aria-label="Edit card"
                  title="Edit card">
                  <img src="icons/edit.png" alt="" class="edit-btn-icon" aria-hidden="true" />
                </button>
                <div class="face-content" id="backContent"></div>
              </div>
              <div class="swipe-glow" id="swipeGlow" aria-hidden="true"></div>
              <div class="swipe-badge" id="swipeBadge" aria-hidden="true"></div>
            </div>
            <div id="nextFlashcard" class="flashcard session-next-card hidden" aria-hidden="true">
              <div class="face" id="nextFace">
                <div class="card-corner-label">
                  <span class="session-label-full">Question</span>
                  <span class="session-label-short">Q</span>
                </div>
                <div class="study-topic-pill face-topic-pill hidden" id="nextTopicPill"></div>
                <button class="btn card-edit-btn" type="button" tabindex="-1" aria-hidden="true" disabled>
                  <img src="icons/edit.png" alt="" class="edit-btn-icon" aria-hidden="true" />
                </button>
                <div class="face-content" id="nextContent"></div>
              </div>
            </div>
          </div>
          <div class="controls">
            <button class="btn traffic green" data-grade="correct">Correct</button>
            <button class="btn traffic yellow" data-grade="partial">Not quite</button>
            <button class="btn traffic red" data-grade="wrong">Wrong</button>
          </div>
        </div>
      </section>

      <section class="panel" id="editorPanel">
        <div class="section editor-shell">
          <div class="controls" style="margin-bottom:10px; align-items:center; margin-inline: 0">
            <button class="btn" id="backToDeckBtn" aria-label="Back to deck">
              <img src="icons/back.png" alt="" class="back-btn-icon" aria-hidden="true" />
            </button>
            <div>
              <h2 id="editorTitle" style="margin:0;">+</h2>
              <!-- <div class="tiny" id="editorSubtitle">Autosaved locally</div> -->
            </div>
            <div class="editor-header-actions">
              <button class="btn editor-shortcuts-btn" id="openEditorIntroBtn" type="button">Shortcuts</button>
              <button class="btn editor-sidebar-toggle" id="toggleEditorSidebarBtn">Cards</button>
            </div>
          </div>
          <div id="editorOverlay" class="editor-overlay"></div>
          <div class="editor-grid">
            <div class="editor-list editor-sidebar" style="overflow: auto;">
              <div class="tiny">Existing cards</div>
              <div id="editorCardsList" class="editor-panel" style="display: block;"></div>
            </div>
            <div class="editor-separator" aria-hidden="true"></div>
            <div class="editor-panel editor-main">
              <div class="editor-main-scroll">
                <div class="editor-field">
                  <div class="field-head">
                    <label>Question</label>
                    <!-- <button class="btn btn-small formula-btn" data-formula-target="cardPrompt" type="button">Formula</button> -->
                  </div>
                  <div class="editor-input-media-row">
                    <textarea id="cardPrompt" placeholder="Type your question..."></textarea>
                    <div id="questionImagePreview" class="image-preview">Drop image here</div>
                  </div>
                  <div class="text-toolbar" data-group="create-question">
                    <div class="toolbar-segment">
                      <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                        data-group="create-question" data-align="left" aria-label="Align left"
                        title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                      <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                        data-group="create-question" data-align="center" aria-label="Align center"
                        title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                      <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                        data-group="create-question" data-align="justify" aria-label="Align justify"
                        title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
                    </div>
                    <div class="toolbar-segment">
                      <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                        data-target="cardPrompt" data-list="ul">‚Ä¢ List</button>
                      <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                        data-target="cardPrompt" data-list="ol">1. List</button>
                      <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                        data-target="cardPrompt">Table</button>
                    </div>
                  </div>
                  <div class="field-error hidden" id="questionError">Please fill in the question.</div>
                </div>
                <hr style="border-color:#30456f; width: 97%;">
                <!-- <div class="qa-editor-separator" aria-hidden="true"></div> -->
                <div class="editor-field" id="answerField">
                  <div class="mcq-primary-row" id="primaryAnswerRow">
                    <div class="mcq-primary-header hidden" id="primaryAnswerHeader">
                      <span class="mcq-badge correct" id="primaryAnswerBadge">Correct Answer ‚úì</span>
                      <label class="toggle mcq-toggle">
                        <input type="checkbox" id="primaryAnswerToggle" checked />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                    <div class="field-head">
                      <label>Answer</label>
                      <!-- <button class="btn btn-small formula-btn" data-formula-target="cardAnswer" type="button">Formula</button> -->
                    </div>
                    <div class="editor-input-media-row">
                      <textarea id="cardAnswer" placeholder="Type the answer..."></textarea>
                      <div id="answerImagePreview" class="image-preview">Drop image here</div>
                    </div>
                    <div class="text-toolbar" data-group="create-answer">
                      <div class="toolbar-segment">
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-answer" data-align="left" aria-label="Align left"
                          title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-answer" data-align="center" aria-label="Align center"
                          title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-answer" data-align="justify" aria-label="Align justify"
                          title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
                      </div>
                      <div class="toolbar-segment">
                        <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                          data-target="cardAnswer" data-list="ul">‚Ä¢ List</button>
                        <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                          data-target="cardAnswer" data-list="ol">1. List</button>
                        <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                          data-target="cardAnswer">Table</button>
                      </div>
                    </div>
                  </div>
                  <div class="editor-options">
                    <div class="tiny">Multi-select answers (optional)</div>
                    <div class="text-toolbar hidden" id="createOptionsToolbar" data-group="create-options">
                      <div class="toolbar-segment">
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-options" data-align="left" aria-label="Options align left"
                          title="Options align left"><img src="icons/links.png" alt=""></button>
                        <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                          data-group="create-options" data-align="center" aria-label="Options align center"
                          title="Options align center"><img src="icons/center.png" alt=""></button>
                      </div>
                    </div>
                    <div id="mcqOptions" class="hidden"></div>
                  </div>
                  <div class="field-error hidden" id="answerError">Please enter at least one answer.</div>
                </div>
              </div>
              <div class="editor-footer editor-footer-stack">
                <button class="btn" id="addMcqOptionBtn">Add Answer</button>
                <button class="btn" id="addCardBtn" style="width: 100%; background-color: #d42dba6e">Create
                  Flashcard</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="panel" id="contentExchangePanel">
        <div class="section content-exchange-section">
          <div class="editor-header content-exchange-panel-header">
            <h3>Content Exchange</h3>
            <div class="panel-header-actions">
              <button class="btn refresh-icon-btn" id="reloadContentExchangeBtn" type="button"
                aria-label="Reload content exchange data" title="Reload users">
                <img src="icons/refresh.svg" alt="" aria-hidden="true" />
              </button>
              <button class="btn close-icon-btn" id="closeContentExchangeBtn" type="button"
                aria-label="Close content exchange panel" title="Close">
                <img src="icons/close.svg" alt="" aria-hidden="true" />
              </button>
            </div>
          </div>
          <div class="content-exchange-scroll">
            <div class="tiny" id="contentExchangeStatus">Load user datasets and import selected content.</div>
            <div class="tiny content-exchange-policy-hint" id="contentExchangePolicyHint"></div>
            <div id="contentExchangeTree" class="content-exchange-tree"></div>
          </div>
          <!-- <pre id="contentExchangeLogOutput" class="content-exchange-log-output" aria-live="polite"></pre> -->
        </div>
      </section>
    </div>
  </main>

  <script>
    // Temporary local snapshot mode (disables Supabase API queries in the app runtime).
    window.__LOCAL_SNAPSHOT_MODE__ = window.__LOCAL_SNAPSHOT_MODE__ ?? false;
    window.__LOCAL_SNAPSHOT_PATH__ = window.__LOCAL_SNAPSHOT_PATH__ || './flashcards-export.json';

    // Supabase project config.
    window.__SUPABASE_URL__ = window.__SUPABASE_URL__ || 'https://ioizksaimszcsqkwqkhn.supabase.co';
    window.__SUPABASE_ANON_KEY__ = window.__SUPABASE_ANON_KEY__ || 'sb_publishable_eMvhc7DI6u_CpahCZ6dPOQ_99NFTjEk';
    window.__SUPABASE_PICTURES_BUCKET__ = window.__SUPABASE_PICTURES_BUCKET__ || 'Pictures';
    window.__APP_VERSION__ = window.__APP_VERSION__ || 'v2026.02.24.02';
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/app-globals.js" defer></script>
  <script src="js/core-utils.js" defer></script>
  <script src="js/review-panel.js" defer></script>
  <script src="js/server-communication.js" defer></script>
  <script src="js/data-access.js" defer></script>
  <script src="js/device-interactions.js" defer></script>
  <script src="js/navigation-layout.js" defer></script>
  <script src="js/text-rendering.js" defer></script>
  <script src="js/media-handling.js" defer></script>
  <script src="js/sidebar-subject-management.js" defer></script>
  <script src="js/subject-topic-panel.js" defer></script>
  <script src="js/editor-panel.js" defer></script>
  <script src="js/deck-search-panel.js" defer></script>
  <script src="js/study-session.js" defer></script>
  <script src="js/settings-management.js" defer></script>
  <script src="js/bootstrap.js" defer></script>

  <dialog id="subjectDialog" class="modal subject-edit-modal">
    <h3>New Subject</h3>
    <div class="subject-edit-grid">
      <div class="subject-edit-field">
        <label>Name</label>
        <input id="subjectNameInput" placeholder="e.g., Fluid Mechanics" />
      </div>
      <div class="subject-edit-field">
        <label>Accent Color</label>
        <input type="color" id="subjectAccentPicker" value="#2dd4bf" />
      </div>
      <div class="subject-edit-field">
        <label>Accent Hex</label>
        <input id="subjectAccentText" value="#2dd4bf" />
      </div>
      <div class="subject-edit-field">
        <label>Exam Date</label>
        <div class="subject-date-picker-wrap">
          <input id="subjectExamDateInput" type="text" inputmode="numeric" placeholder="DD/MM/YYYY" autocomplete="off" />
          <button class="btn subject-date-picker-btn" id="subjectExamDatePickerBtn" type="button"
            aria-label="Open exam date picker" title="Open date picker">üìÖ</button>
          <input id="subjectExamDateNativeInput" class="subject-date-native-input" type="date" lang="en-GB"
            tabindex="-1" aria-hidden="true" />
        </div>
      </div>
      <div class="subject-edit-field subject-edit-checkbox-field">
        <div class="subject-review-checkbox-wrap">
          <label class="subject-review-checkbox-label" for="subjectExcludeFromReviewInput">
            <input id="subjectExcludeFromReviewInput" type="checkbox" />
            <span>Exclude from review</span>
          </label>
          <span class="subject-review-info-icon" role="note" tabindex="0"
            title="This option applies only after the exam date has passed.">i</span>
        </div>
      </div>
      <div class="subject-edit-field">
        <label>Palette</label>
        <div class="palette subject-edit-palette" id="subjectPalette">
          <button type="button" data-color="#2dd4bf" style="background:#2dd4bf"></button>
          <button type="button" data-color="#22c55e" style="background:#22c55e"></button>
          <button type="button" data-color="#f59e0b" style="background:#f59e0b"></button>
          <button type="button" data-color="#ef4444" style="background:#ef4444"></button>
          <button type="button" data-color="#60a5fa" style="background:#60a5fa"></button>
          <button type="button" data-color="#a855f7" style="background:#a855f7"></button>
          <button type="button" data-color="#f472b6" style="background:#f472b6"></button>
        </div>
      </div>
    </div>
    <div class="controls subject-edit-actions">
      <button class="btn save-primary" id="createSubjectBtn">Create Subject</button>
      <div class="subject-edit-secondary-actions subject-create-secondary-actions">
        <button class="btn" id="cancelSubjectBtn">Cancel</button>
      </div>
    </div>
  </dialog>

  <dialog id="subjectEditDialog" class="modal subject-edit-modal">
    <h3>Edit Subject</h3>
    <div class="subject-edit-grid">
      <div class="subject-edit-field">
        <label>Name</label>
        <input id="editSubjectName" placeholder="e.g., Fluid Mechanics" />
      </div>
      <div class="subject-edit-field">
        <label>Accent Color</label>
        <input type="color" id="editSubjectColor" value="#2dd4bf" />
      </div>
      <div class="subject-edit-field">
        <label>Exam Date</label>
        <div class="subject-date-picker-wrap">
          <input id="editSubjectExamDate" type="text" inputmode="numeric" placeholder="DD/MM/YYYY" autocomplete="off" />
          <button class="btn subject-date-picker-btn" id="editSubjectExamDatePickerBtn" type="button"
            aria-label="Open exam date picker" title="Open date picker">üìÖ</button>
          <input id="editSubjectExamDateNativeInput" class="subject-date-native-input" type="date" lang="en-GB"
            tabindex="-1" aria-hidden="true" />
        </div>
      </div>
      <div class="subject-edit-field subject-edit-checkbox-field">
        <div class="subject-review-checkbox-wrap">
          <label class="subject-review-checkbox-label" for="editSubjectExcludeFromReview">
            <input type="checkbox" id="editSubjectExcludeFromReview" />
            <span>Exclude from review</span>
          </label>
          <span class="subject-review-info-icon" role="note" tabindex="0"
            title="This option applies only after the exam date has passed.">i</span>
        </div>
      </div>
    </div>
    <div class="controls subject-edit-actions">
      <button class="btn save-primary" id="saveSubjectEditBtn">Save</button>
      <div class="subject-edit-secondary-actions subject-edit-secondary-actions-single">
        <button class="btn" id="cancelSubjectEditBtn">Cancel</button>
      </div>
    </div>
  </dialog>

  <dialog id="subjectArchiveDialog" class="modal">
    <h3>Archived Subjects</h3>
    <div class="tiny archive-dialog-meta" id="archiveSubjectCount">0 archived subjects</div>
    <div id="archiveSubjectList" class="content-exchange-tree archive-subject-list"></div>
    <div class="controls" style="margin-top:12px; margin-inline:0;">
      <button class="btn" id="closeSubjectArchiveBtn" type="button">Close</button>
    </div>
  </dialog>

  <dialog id="topicEditDialog" class="modal subject-edit-modal">
    <h3>Edit Topic</h3>
    <div class="topic-edit-field">
      <label>Name</label>
      <input id="editTopicName" placeholder="e.g., Thermodynamics" />
    </div>
    <div class="controls topic-edit-actions">
      <button class="btn save-primary" id="saveTopicEditBtn" type="button">Save</button>
      <button class="btn" id="cancelTopicEditBtn" type="button">Cancel</button>
    </div>
  </dialog>

  <dialog id="moveCardsDialog" class="modal">
    <h3>Move Cards</h3>
    <div class="tiny" id="moveCardsSelectionInfo" style="margin-bottom:10px;">0 cards selected</div>
    <div class="grid two">
      <div>
        <label>Subject</label>
        <select id="moveCardsSubjectSelect"></select>
      </div>
      <div>
        <label>Topic</label>
        <select id="moveCardsTopicSelect"></select>
      </div>
    </div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn" id="confirmMoveCardsBtn" type="button">Move</button>
      <button class="btn" id="cancelMoveCardsBtn" type="button">Cancel</button>
    </div>
  </dialog>

  <dialog id="moveTopicsDialog" class="modal">
    <h3>Move Topics</h3>
    <div class="tiny" id="moveTopicsSelectionInfo" style="margin-bottom:10px;">0 topics selected</div>
    <div>
      <label>Target Subject</label>
      <select id="moveTopicsSubjectSelect"></select>
    </div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn" id="confirmMoveTopicsBtn" type="button">Move</button>
      <button class="btn" id="cancelMoveTopicsBtn" type="button">Cancel</button>
    </div>
  </dialog>

  <dialog id="topicSearchDialog" class="modal modal-wide" style="padding-bottom: 0;">
    <div class="topic-search-sticky-head">
      <div class="editor-header">
        <h3>Search Cards</h3>
        <button class="btn close-icon-btn" id="closeTopicSearchBtn" type="button" aria-label="Close search dialog"
          title="Close">
          <img src="icons/close.svg" alt="" aria-hidden="true" />
        </button>
      </div>
      <div class="topic-search-controls">
        <input id="topicSearchInput" type="text" placeholder="Search in question and answer text..." />
        <button class="btn" id="runTopicSearchBtn" type="button">Search</button>
      </div>
      <div class="tiny" id="topicSearchMeta">Enter a search term.</div>
    </div>
    <div id="topicSearchResults" class="card-grid topic-search-results"></div>
  </dialog>

  <dialog id="progressCheckDialog" class="modal modal-wide progress-check-dialog">
    <div class="topic-search-sticky-head progress-check-sticky-head">
      <div class="editor-header">
        <h3>Cards Status Check</h3>
        <div class="panel-header-actions">
          <button class="btn refresh-icon-btn" id="refreshProgressCheckBtn" type="button"
            aria-label="Refresh status table" title="Refresh">
            <img src="icons/refresh.svg" alt="" aria-hidden="true" />
          </button>
          <button class="btn close-icon-btn" id="closeProgressCheckBtn" type="button"
            aria-label="Close progress check dialog" title="Close">
            <img src="icons/close.svg" alt="" aria-hidden="true" />
          </button>
        </div>
      </div>
      <div class="controls" style="margin:0; margin-top:8px; width: 100%; align-items: center;">
        <div class="tiny" id="progressCheckMeta">Loading...</div>
      </div>
    </div>
    <div class="progress-check-table-wrap">
      <table class="progress-check-table" id="progressCheckTable">
        <thead>
          <tr>
            <th data-col="subject">
              <div class="progress-check-th-content">
                <span>Subject</span>
                <button class="progress-check-header-btn" type="button" data-col="subject"
                  aria-label="Filter subject">‚ñæ</button>
              </div>
            </th>
            <th data-col="topic">
              <div class="progress-check-th-content">
                <span>Topic</span>
                <button class="progress-check-header-btn" type="button" data-col="topic"
                  aria-label="Filter topic">‚ñæ</button>
              </div>
            </th>
            <th data-col="question">
              <div class="progress-check-th-content">
                <span>Question</span>
                <button class="progress-check-header-btn" type="button" data-col="question"
                  aria-label="Filter question">‚ñæ</button>
              </div>
            </th>
            <th data-col="current">
              <div class="progress-check-th-content">
                <span>Current</span>
                <button class="progress-check-header-btn" type="button" data-col="current"
                  aria-label="Filter current">‚ñæ</button>
              </div>
            </th>
            <th data-col="score">
              <div class="progress-check-th-content">
                <span>Score</span>
                <button class="progress-check-header-btn" type="button" data-col="score"
                  aria-label="Filter score">‚ñæ</button>
              </div>
            </th>
            <th data-col="streak">
              <div class="progress-check-th-content">
                <span>Streak</span>
                <button class="progress-check-header-btn" type="button" data-col="streak"
                  aria-label="Filter streak">‚ñæ</button>
              </div>
            </th>
            <th data-col="lastGrade">
              <div class="progress-check-th-content">
                <span>Last Grade</span>
                <button class="progress-check-header-btn" type="button" data-col="lastGrade"
                  aria-label="Filter last grade">‚ñæ</button>
              </div>
            </th>
            <th data-col="lastAnsweredAt">
              <div class="progress-check-th-content">
                <span>Last Answered</span>
                <button class="progress-check-header-btn" type="button" data-col="lastAnsweredAt"
                  aria-label="Filter last answered">‚ñæ</button>
              </div>
            </th>
            <th data-col="totals">
              <div class="progress-check-th-content">
                <span>Totals (C/P/W)</span>
                <button class="progress-check-header-btn" type="button" data-col="totals"
                  aria-label="Filter totals">‚ñæ</button>
              </div>
            </th>
            <th data-col="history">
              <div class="progress-check-th-content">
                <span>History</span>
                <button class="progress-check-header-btn" type="button" data-col="history"
                  aria-label="Filter history">‚ñæ</button>
              </div>
            </th>
          </tr>
        </thead>
        <tbody id="progressCheckTableBody"></tbody>
      </table>
    </div>
    <div class="progress-check-header-menu hidden" id="progressCheckHeaderMenu">
      <div class="progress-check-header-menu-title" id="progressCheckHeaderMenuTitle">Filter</div>
      <div class="progress-check-header-menu-sort">
        <button class="btn btn-small" id="progressCheckSortAscBtn" type="button">Sort ASC</button>
        <button class="btn btn-small" id="progressCheckSortDescBtn" type="button">Sort DESC</button>
      </div>
      <label class="progress-check-select-all">
        <input id="progressCheckSelectAllValues" type="checkbox" />
        <span>Select all</span>
      </label>
      <input id="progressCheckValueSearch" type="search" placeholder="Search values..." />
      <div class="progress-check-header-menu-values" id="progressCheckHeaderMenuValues"></div>
    </div>
  </dialog>

  <dialog id="sessionFilterDialog" class="modal">
    <div class="editor-header">
      <h3>Session Filter</h3>
      <button class="btn close-icon-btn" id="closeSessionFilterBtn" type="button" aria-label="Close session filter"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="session-filter-list">
      <label class="session-filter-option">
        <input id="sessionFilterAll" type="checkbox" />
        <span>All (remaining today)</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterCorrect" type="checkbox" style="background-color: var(--success)" />
        <span>Correctly answered (mastered)</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterPartial" type="checkbox" style="background-color: var(--warn)" />
        <span>Partially</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterWrong" type="checkbox" style="background-color: var(--danger)" />
        <span>Wrong</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterNotAnswered" type="checkbox" />
        <span>Not answered today</span>
      </label>
      <label class="session-filter-option">
        <input id="sessionFilterNotAnsweredYet" type="checkbox" />
        <span>Not answered yet</span>
      </label>
    </div>
    <div class="tiny" style="margin-top:10px;">All mode excludes cards mastered today (3x correct in a row).</div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn save-primary" id="saveSessionFilterBtn" type="button">Apply</button>
    </div>
  </dialog>

  <canvas id="sessionCompleteConfettiCanvas" aria-hidden="true"></canvas>

  <dialog id="sessionCompleteDialog" class="modal">
    <div class="editor-header">
      <h3>Session Complete</h3>
      <button class="btn close-icon-btn" id="closeSessionCompleteBtn" type="button"
        aria-label="Close session complete dialog" title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="session-complete-message" id="sessionCompleteMessage">Great work!</div>
    <div class="session-complete-stats">
      <div class="session-complete-stat">
        <div class="tiny">Time</div>
        <strong id="sessionCompleteDuration">0:00</strong>
      </div>
      <div class="session-complete-stat">
        <div class="tiny">Remaining Cards</div>
        <strong id="sessionCompleteRemaining">0</strong>
      </div>
    </div>
    <div class="session-repeat-controls">
      <div class="tiny">Next Session Size</div>
      <div class="counter">
        <button class="btn counter-btn" id="sessionRepeatMinus" type="button">-</button>
        <div class="counter-value" id="sessionRepeatSizeValue">0 / 0</div>
        <button class="btn counter-btn" id="sessionRepeatPlus" type="button">+</button>
      </div>
    </div>
    <div class="controls" style="margin-top:14px; margin-inline: 0">
      <button class="btn" id="startAnotherSessionBtn" type="button" style="width:100%;">Start Another Session</button>
    </div>
  </dialog>

  <dialog id="settingsDialog" class="modal">
    <div class="editor-header">
      <h3>Settings & Data</h3>
      <button class="btn close-icon-btn" id="closeSettingsBtn" type="button" aria-label="Close settings dialog"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <p class="tiny settings-intro">Manage backups, diagnostics, and account actions.</p>
    <div class="settings-layout">
      <section class="settings-card">
        <h4 class="settings-card-title">Backup</h4>
        <div class="settings-actions settings-actions-grid">
          <button class="btn" id="exportJsonBtn" type="button">Export JSON</button>
          <button class="btn" id="exportCsvBtn" type="button">Export CSV</button>
          <button class="btn" id="importJsonBtn" type="button">Import JSON</button>
          <button class="btn" id="importCsvBtn" type="button">Import CSV</button>
          <input id="importInput" type="file" accept="application/json" class="hidden" />
          <input id="importCsvInput" type="file" accept=".csv,text/csv" class="hidden" />
        </div>
      </section>

      <section class="settings-card">
        <h4 class="settings-card-title">Tools</h4>
        <div class="settings-actions settings-actions-grid">
          <button class="btn" id="openProgressCheckFromSettingsBtn" type="button">‚úì Check Status</button>
          <button class="btn" id="openContentExchangeBtn" type="button">Content Exchange</button>
          <button class="btn" id="openIntroFromSettingsBtn" type="button">Open Intro</button>
        </div>
      </section>

      <section class="settings-card settings-card-account">
        <h4 class="settings-card-title">Account</h4>
        <div class="settings-actions">
          <button class="btn delete" id="signOutBtn" type="button">Sign Out</button>
        </div>
      </section>
    </div>
  </dialog>

  <dialog id="imageMigrationLogDialog" class="modal">
    <div class="editor-header">
      <h3>Image Migration</h3>
      <button class="btn close-icon-btn" id="closeImageMigrationLogBtn" type="button"
        aria-label="Close image migration dialog" title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="migration-log-meta tiny" id="imageMigrationStatus">Waiting to start...</div>
    <pre id="imageMigrationLogOutput" class="migration-log-output" aria-live="polite"></pre>
    <div class="controls migration-log-actions">
      <button class="btn" id="doneImageMigrationLogBtn" type="button">Close</button>
    </div>
  </dialog>

  <dialog id="editCardDialog" class="modal modal-wide">
    <div class="editor-header">
      <h3>Edit Flashcard</h3>
      <button class="btn close-icon-btn" id="closeEditCardBtn" type="button" aria-label="Close edit card dialog"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="editor-grid editor-grid-single">
      <div class="editor-panel editor-main">
        <div class="editor-main-scroll">
          <div class="editor-field">
            <div class="field-head">
              <label>Question</label>
              <!-- <button class="btn btn-small formula-btn" data-formula-target="editCardPrompt" type="button">Formula</button> -->
            </div>
            <div class="editor-input-media-row">
              <textarea id="editCardPrompt" placeholder="Type your question..."></textarea>
              <div id="editQuestionImagePreview" class="image-preview">Drop image here</div>
            </div>
            <div class="text-toolbar" data-group="edit-question">
              <div class="toolbar-segment">
                <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                  data-group="edit-question" data-align="left" aria-label="Align left"
                  title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                  data-group="edit-question" data-align="center" aria-label="Align center"
                  title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                  data-group="edit-question" data-align="justify" aria-label="Align justify"
                  title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
              </div>
              <div class="toolbar-segment">
                <button class="btn btn-small toolbar-btn" type="button" data-action="list" data-target="editCardPrompt"
                  data-list="ul">‚Ä¢ List</button>
                <button class="btn btn-small toolbar-btn" type="button" data-action="list" data-target="editCardPrompt"
                  data-list="ol">1. List</button>
                <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                  data-target="editCardPrompt">Table</button>
              </div>
            </div>
          </div>
          <!-- <div class="qa-editor-separator" aria-hidden="true"></div> -->
          <hr style="border-color:#30456f;width: 97%;">
          <div class="editor-field" id="editAnswerField">
            <div class="mcq-primary-row" id="editPrimaryAnswerRow">
              <div class="mcq-primary-header hidden" id="editPrimaryAnswerHeader">
                <span class="mcq-badge correct" id="editPrimaryAnswerBadge">Correct Answer ‚úì</span>
                <label class="toggle mcq-toggle">
                  <input type="checkbox" id="editPrimaryAnswerToggle" checked />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="field-head">
                <label>Answer</label>
                <!-- <button class="btn btn-small formula-btn" data-formula-target="editCardAnswer" type="button">Formula</button> -->
              </div>
              <div class="editor-input-media-row">
                <textarea id="editCardAnswer" placeholder="Type the answer..."></textarea>
                <div id="editAnswerImagePreview" class="image-preview">Drop image here</div>
              </div>
              <div class="text-toolbar" data-group="edit-answer">
                <div class="toolbar-segment">
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-answer" data-align="left" aria-label="Align left"
                    title="Align left (Cmd/Ctrl+L)"><img src="icons/links.png" alt=""></button>
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-answer" data-align="center" aria-label="Align center"
                    title="Align center (Cmd/Ctrl+C)"><img src="icons/center.png" alt=""></button>
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-answer" data-align="justify" aria-label="Align justify"
                    title="Align justify (Cmd/Ctrl+J)"><img src="icons/rechts.png" alt=""></button>
                </div>
                <div class="toolbar-segment">
                  <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                    data-target="editCardAnswer" data-list="ul">‚Ä¢ List</button>
                  <button class="btn btn-small toolbar-btn" type="button" data-action="list"
                    data-target="editCardAnswer" data-list="ol">1. List</button>
                  <button class="btn btn-small toolbar-btn" type="button" data-action="table"
                    data-target="editCardAnswer">Table</button>
                </div>
              </div>
            </div>
            <div class="editor-options">
              <div class="tiny">Multi-select answers (optional)</div>
              <div class="text-toolbar hidden" id="editOptionsToolbar" data-group="edit-options">
                <div class="toolbar-segment">
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-options" data-align="left" aria-label="Options align left"
                    title="Options align left"><img src="icons/links.png" alt=""></button>
                  <button class="btn btn-small toolbar-btn align-icon-btn" type="button" data-action="align"
                    data-group="edit-options" data-align="center" aria-label="Options align center"
                    title="Options align center"><img src="icons/center.png" alt=""></button>
                </div>
              </div>
              <div id="editMcqOptions" class="hidden"></div>
              <button class="btn" id="editAddMcqOptionBtn">Add Answer</button>
            </div>
          </div>
        </div>
        <div class="editor-footer">
          <button class="btn save-primary" id="saveEditCardBtn" style="position: sticky; bottom: 0;">Save
            Changes</button>
        </div>
      </div>
    </div>
  </dialog>

  <dialog id="cardPreviewDialog" class="modal modal-wide card-preview-dialog">
    <div class="editor-header">
      <h3>Study Preview</h3>
      <button class="btn close-icon-btn" id="closeCardPreviewBtn" type="button" aria-label="Close study preview"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="tiny">Tap the card to flip. Space also flips.</div>
    <div class="card-preview-shell">
      <div class="flash-area card-preview-area">
        <div id="previewFlashcard" class="flashcard">
          <div class="face">
            <div class="card-corner-label">
              <span class="session-label-full">Question</span>
              <span class="session-label-short">Q</span>
            </div>
            <div class="study-topic-pill face-topic-pill hidden" id="previewFrontTopicPill"></div>
            <div class="face-content" id="previewFrontContent"></div>
          </div>
          <div class="face back">
            <div class="card-corner-label">
              <span class="session-label-full">Answer</span>
              <span class="session-label-short">A</span>
            </div>
            <div class="study-topic-pill face-topic-pill hidden" id="previewBackTopicPill"></div>
            <div class="face-content" id="previewBackContent"></div>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <dialog id="tableDialog" class="modal modal-table-builder">
    <div class="editor-header">
      <h3>Table Generator</h3>
      <button class="btn close-icon-btn" id="closeTableBtn" type="button" aria-label="Close table dialog" title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="tiny" id="tableTargetLabel">Target: Question</div>
    <div class="table-builder-controls">
      <div class="table-builder-size">
        <label for="tableRowsInput">Rows</label>
        <div class="table-builder-stepper">
          <button class="btn btn-small" id="tableRowsDownBtn" type="button" aria-label="Decrease rows">-</button>
          <input id="tableRowsInput" type="number" min="1" max="20" step="1" value="3" />
          <button class="btn btn-small" id="tableRowsUpBtn" type="button" aria-label="Increase rows">+</button>
        </div>
      </div>
      <div class="table-builder-size">
        <label for="tableColsInput">Columns</label>
        <div class="table-builder-stepper">
          <button class="btn btn-small" id="tableColsDownBtn" type="button" aria-label="Decrease columns">-</button>
          <input id="tableColsInput" type="number" min="1" max="10" step="1" value="3" />
          <button class="btn btn-small" id="tableColsUpBtn" type="button" aria-label="Increase columns">+</button>
        </div>
      </div>
      <div class="table-builder-header-toggle">
        <span>Header</span>
        <label class="toggle">
          <input id="tableHeaderToggle" type="checkbox" checked />
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="table-builder-align" role="group" aria-label="Selected cell alignment">
        <div class="tiny" id="tableCellSelectionLabel">Cell: none selected</div>
        <div class="table-builder-align-buttons">
          <button class="btn btn-small toolbar-btn table-builder-align-btn align-icon-btn" id="tableAlignLeftBtn"
            type="button" data-align="left" aria-label="Align selected cell left"><img src="icons/links.png"
              alt=""></button>
          <button class="btn btn-small toolbar-btn table-builder-align-btn align-icon-btn" id="tableAlignCenterBtn"
            type="button" data-align="center" aria-label="Align selected cell center"><img src="icons/center.png"
              alt=""></button>
          <button class="btn btn-small toolbar-btn table-builder-align-btn align-icon-btn" id="tableAlignRightBtn"
            type="button" data-align="right" aria-label="Align selected cell right"><img src="icons/rechts.png"
              alt=""></button>
        </div>
      </div>
      <div class="table-builder-merge" role="group" aria-label="Merge selected cells">
        <button class="btn btn-small" id="tableMergeBtn" type="button">Merge</button>
        <button class="btn btn-small" id="tableUnmergeBtn" type="button">Unmerge</button>
      </div>
    </div>
    <div class="tiny table-builder-help">Edit cells directly. Click start cell, then Shift+Click end cell to select a
      full range, then Merge/Unmerge.
      Use Shift + Enter to insert/update.</div>
    <div id="tableBuilderGrid" class="table-builder-grid" role="region" aria-label="Editable table grid"></div>
    <div class="controls" style="margin-top:12px; margin-inline: 0">
      <button class="btn" id="insertTableBtn" type="button" style="width: 100%; background-color: #6f2bd4">Insert
        Table</button>
    </div>
  </dialog>

  <dialog id="formulaDialog" class="modal modal-wide">
    <div class="editor-header">
      <h3>Formula Editor</h3>
      <button class="btn close-icon-btn" id="closeFormulaBtn" type="button" aria-label="Close formula dialog"
        title="Close">
        <img src="icons/close.svg" alt="" aria-hidden="true" />
      </button>
    </div>
    <div class="editor-grid editor-grid-single">
      <div class="editor-panel editor-main">
        <div class="editor-field">
          <div class="field-head">
            <label>LaTeX Formula</label>
            <div class="toggle-row">
              <label class="toggle">
                <input type="checkbox" id="formulaDisplayToggle" />
                <span class="toggle-slider"></span>
              </label>
              <span class="tiny">Display mode</span>
            </div>
          </div>
          <textarea id="formulaInput" placeholder="e.g. \\frac{a}{b}"></textarea>
          <div class="formula-preview">
            <div id="formulaRender" class="formula-render"></div>
          </div>
          <div class="field-error hidden" id="formulaError"></div>
        </div>
        <div class="controls" style="justify-content: space-between;">
          <div class="tiny" id="formulaTargetLabel">Target: Question</div>
          <div class="formula-actions">
            <button class="btn" id="cancelFormulaBtn" type="button">Cancel</button>
            <button class="btn save-primary formula-insert" id="insertFormulaBtn" type="button">Insert Formula</button>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <div id="sessionImageLightbox" class="session-image-lightbox hidden" aria-hidden="true">
    <img id="sessionImageLightboxImg" src="" alt="Expanded flashcard image" />
  </div>

</body>

</html>
